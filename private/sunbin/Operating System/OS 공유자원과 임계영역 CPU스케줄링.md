# OS 공유자원과 임계영역 / CPU스케줄링

> **공유자원**
> 

여러 프로세스나 스레드가 동시에 접근할 수 있는 자원

- 전역 변수
- 파일
- DB
- 메모리
- 리스트/딕셔너리

만약 여러 프로세스나 스레드가 동시에 해당 자원에 접근한다면?

```java
count = 0
counter += 1 (process A)
counter += 1 (process B)
count = 1
```

공유 자원을 동시에 읽거나 쓰는 상황을 **경쟁 상태**라고 한다

> **임계영역**
> 

공유 자원에 접근할 때 순서 등의 이유로 결과가 달라지는 영역

위 설명과 같이 경쟁 상태가 발생할 수 있는 코드 영역/보호해야 하는 영역

임계영역의 근본적인 해결책은 공유 자원에 대한 동시접근을 방지하는 것

1. 상호 배제
    
    2개 이상의 프로세스가 동시에 자원에 접근할 수 없도록 한다.
    
    다른 스레드가 동시에 자원을 변경할 수 없도록 보장한다
    
2. 진행
    
    임계영역에서 실행을 마친 스레드는 다른 스레드의 진입을 방해하지 말아야한다
    
3. 한계 대기
    
    모든 스레드는 유한 시간 내에 임계영역에 진입해야한다
    
    무한히 대기 상태로 남겨두지 않는다
    

> **Dead Lock(교착 상태)**
> 

둘 이상의 프로세스가 자원을 보유하고 있는 상황에서 다른 프로세스가 점유하는 자원을 서로 기다려 무한 대기 상태에 빠지는 것

**교착 상태 발생 조건**

1. 상호 배제
2. 점유 대기
    
    할당된 자원을 가진 상태에서 다른 자원을 기다리는 상태
    
3. 비선점
    
    이미 할당된 자원을 강제로 뺏을 수 없다
    
4. 순환 대기
    
    두 개 이상의 프로세스나 스레드가 서로 다음 자원을 기다리며 무한 대기 상태일 때
    

**교착 상태 해결 방법**

1. 예방
    1. 상호 배제 예방
        
        여러 프로세스가 동시에 공유 자원 사용 가능
        
    2. 비선점 예방
        
        모든 자원에 대한 선점을 허용
        
    3. 점유 대기 부정
        
        모든 자원을 한꺼번에 요구하고 허용할 때까지 작업을 보류, 대기 조건을 성립하지 않도록 유지
        
    4. 순환 대기 부정
        
        자원을 선형으로 분류하여 각 프로세스는 분류된 자원을 한쪽 방향으로만 자원을 요구하도록 함
        

> **CPU스케줄링**
> 

CPU스케줄링은 운영체제가 프로세스에 CPU자원을 할당하는 정책

여러 프로세스가 동시에 실행될 때, CPU를 어떤 순서로, 얼마나 사용하는지를 결정

스케줄링 방식은 선점형, 비선점형 방식으로 나뉜다

> **선점형 스케줄링**
> 

실행중인 프로세스로부터 CPU자원을 강제로 빼앗아 다른 프로세스에게 할당하는 방식

우선순위가 높거나, 할당 시간이 만료된 프로세스를 중단하고 CPU를 빼았는다

**장점**

1. 응답성 보장
    
    우선순위가 높은 프로세스가 즉시 실행될 수 있어 실시간 시스템에 적합
    
2. 공정성
    
    모든 프로세스에게 CPU시간을 분배하여 무한 대기를 방지
    

**단점**

1. 컨텍스트 스위칭 비용 부담
    
    스위칭이 자주 발생할 수 밖에 없어 시스템에 부하를 준다
    

> **비선점형 스케줄링**
> 

이미 CPU를 받아 실행중인 프로세스가 스스로 반납하거나, 작업이 완료되기 전까진 CPU를 다른 프로세스에게 빼앗기지 않는 방식

**장점**

1. 컨텍스트 스위칭 비용 적음
    
    스위칭이 자주 일어나지 않아 비용이 적다
    

**단점**

1. 응답 시간 예측 불가
    
    CPU사용시간이 긴 프로세스를 독점한다면 다른 프로세스가 대기할 수 밖에 없다
    
2. 무한 대기 발생
    
    우선순위가 낮은 프로세스라면 영원히 실행되지 않는다