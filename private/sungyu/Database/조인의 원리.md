# 조인의 원리  

**중첩 루프 조인**(Nested Loop Join, NL JOIN)  
> 중첩 for문처럼 루프를 돌며 두 테이블의 튜플을 연결하는 방식  

- 반복문 외부에 있는 테이블을 선행 테이블/외부 테이블(Outer Table) 이라 한다.  
- 반복문 내부에 있는 테이블을 후행 테이블/내부 테이블(Inner Table) 이라 한다.  
- **랜덤 엑세스**(Random Access) 방식으로 데이터에 접근하기 때문에 소규모 테이블에 유리하다.  
- 외부 테이블(Outer Table)의 처리 범위가 커질 수록 내부 테이블(Inner Table) 접근 횟수가 반복되므로 비효율적이다.  

※ 랜덤 엑세스 : 자료를 순차적으로 조사하지 않고 저장장치(디스크 또는 버퍼 캐시)로부터 데이터의 특정 부분을 직접 검색할 수 있는 접근 방법  
  ex) 인덱스를 이용한 접근  
  
```sql
SELECT *
FROM TableA JOIN TableB 
ON TableA.key = TableB.key
```

- `TableA` -> Outer 테이블
- `TableB` -> Inner 테이블
- `TableB(Key)` 에 인덱스 존재 가정

<br>

**TableA**
| key | name |
|-----|------|
| 1   | 피카츄  |
| 2   | 꼬부기  |

**TableB**
| key | major |
|-----|-------|
| 2   | 소프트웨어 |
| 3   | 간호    |

1. Outer 테이블 스캔  
- TableA 데이터 접근 (1, 피카츄) (2, 꼬부기) ...

2. Inner 테이블 인덱스 탐색
- TableB 인덱스에서 key = 2 값 탐색

<br>
<br>

**정렬 병합 조인**(Sort Merge Join)  
> 각각의 테이블을 조인할 컬럼을 기준으로 정렬한 후 조인을 수행하는 방식  

- 데이터를 정렬하고 조인을 수행하기 때문에 **랜덤 엑세스**(Random Access) 방식과 다르게 대용량 테이블들을 조인하고 조인 조건으로 범위 비교 연산(‘<‘, ‘>’)에 유리하다.  
- 정렬할 데이터가 많으면 메모리를 많이 사용하여 성능이 저하될 수 있다. 따라서 정렬돼있거나 정렬할 데이터가 적은 테이블에 유리하다.  

![img1 daumcdn 2](https://github.com/user-attachments/assets/35add0a5-d9d6-4246-b33a-1c37e0dc7018)

<br>
<br>

**해시 조인**(Hash Join)  
> 해시 테이블을 기반으로 조인하는 방법  

- 인덱스를 사용하지 않는다.  
- **동등 조인(‘=‘) 상황**에서만 활용 가능하다.  
- 해시 테이블(Hash Table)을 만들어야 하므로 메모리 공간을 차지한다.  

![img1 daumcdn](https://github.com/user-attachments/assets/2e3fcb3e-970a-437b-bb51-80988d7a42c5)  

<br>

※ 비용기반 DB 옵티마이저가 테이블 통계와 인덱스를 활용하여, 조인을 수행할 알고리즘을 선택하여 수행한다.  
- 힌트 작성 또는 인덱스 설정을 통해 옵티마이저에게 우선순위 설정 가능하다

